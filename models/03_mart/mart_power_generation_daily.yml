version: 2

models:
  - name: mart_power_generation_daily
    description: |
      # Daily Power Generation Mart

      This mart model serves as the primary analytical table for daily power generation analysis across
      German power generation facilities. It combines power generation facts with unit characteristics
      and weather data, providing a comprehensive view for analyzing energy production patterns,
      capacity utilization, and environmental correlations.

      ## Data Model Architecture

      The model follows a three-stage transformation:
      1. **Source Integration**: Combines fact_power_generation, dim_unit, and dim_weather from clean layer
      2. **Enrichment**: Joins data on unit_id and location/timestamp for weather correlation
      3. **Aggregation**: Aggregates hourly readings to daily grain with min/max/avg statistics

      ## Grain
      **One row per power generation unit per day**

      The composite primary key is (power_generation_unit_id, start_date), ensuring one unique record
      for each unit's daily performance.

      ## Key Business Logic

      **Renewable Energy Classification**:
      - Energy sources classified as renewable: Water, Biomass, Waste, Battery Storage, Pumped Storage
      - All other sources (Coal, Natural Gas, Nuclear, etc.) classified as non-renewable
      - Calculated via: `is_renewable` boolean flag

      **Weather Integration**:
      - Weather data joined by postal code and timestamp
      - Provides correlation analysis between weather conditions and power generation
      - Includes temperature, wind speed (multiple heights), solar radiation, and precipitation

      **Aggregation Strategy**:
      - All weather and power metrics aggregated with MAX, AVG, and MIN functions
      - Captures daily variability and peak/trough performance
      - Unit attributes (name, location, capacity) carried forward from dimension

      ## Use Cases

      1. **Energy Production Analysis**: Track daily generation by unit, source type, and region
      2. **Renewable Energy Tracking**: Monitor renewable vs non-renewable energy production
      3. **Capacity Utilization**: Analyze how efficiently units operate relative to capacity
      4. **Weather Impact Studies**: Correlate weather patterns with generation performance
      5. **Operational Monitoring**: Identify units with unusual performance patterns
      6. **Regional Analysis**: Compare generation across German states and cities

      ## Data Quality Notes

      - Some units may have null operator information (4,209 records in current dataset)
      - Weather data availability depends on postal code matching
      - Units without weather station coverage will have null weather metrics

    config:
      materialized: table
      schema: O3_MART

    constraints:
      - type: primary_key
        columns: [power_generation_unit_id, start_date]

    columns:
      # ===========================================
      # PRIMARY KEY COLUMNS
      # ===========================================

      - name: power_generation_unit_id
        description: |
          Unique identifier for the power generation unit (part of composite primary key).

          This ID links to the unit dimension table (clean_dim_unit) and uniquely identifies
          each power generation facility in Germany. Combined with start_date, forms the
          primary key ensuring one record per unit per day.
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('clean_dim_unit')
                field: power_generation_unit_id

      - name: start_date
        description: |
          Date of power generation aggregation (part of composite primary key).

          Represents the calendar day for which all hourly power generation readings have been
          aggregated. This is the primary time dimension for daily trend analysis and reporting.
        tests:
          - not_null

      # ===========================================
      # UNIT DIMENSION ATTRIBUTES
      # ===========================================

      - name: unit_name
        description: |
          Official name of the power generation unit facility.

          Typically includes location identifiers and facility type. Used for user-facing
          reports and facility-level drill-downs.
        tests:
          - not_null

      - name: unit_operator
        description: |
          Company or organization operating the power generation unit.

          Identifies the commercial entity responsible for operating the facility. Note that
          some records may have null operators in the source data (approximately 4,209 records).
          Useful for operator-level performance analysis and benchmarking.

      - name: unit_city
        description: |
          City where the power generation unit is physically located.

          German municipality hosting the facility. Used for geographic analysis and
          regional aggregations.
        tests:
          - not_null

      - name: unit_state
        description: |
          German federal state (Bundesland) where the unit is located.

          One of Germany's 16 federal states. Primary geographic dimension for state-level
          energy production comparisons and regional policy analysis.
        tests:
          - not_null

      - name: energy_source
        description: |
          Type of energy source used for power generation.

          Categories include renewable sources (Wind, Solar, Water, Biomass, Waste) and
          conventional sources (Natural Gas, Coal, Nuclear, Oil). This is the primary dimension
          for energy mix analysis and renewable energy tracking.
        tests:
          - not_null

      - name: is_storage
        description: |
          Boolean flag indicating if the unit has energy storage capability.

          True for facilities that can store energy (e.g., pumped storage, battery systems).
          Important for grid stability analysis and understanding dispatchable capacity.
        tests:
          - not_null
          - accepted_values:
              arguments:
                values: [true, false]

      - name: plant_status
        description: |
          Current operational status of the power plant.

          Indicates whether the facility is operational, under maintenance, decommissioned, etc.
          Critical for understanding active capacity vs total installed capacity.
        tests:
          - not_null

      - name: net_electrical_capacity_mw
        description: |
          Net electrical capacity of the unit in megawatts (MW).

          The maximum continuous electrical output the unit can produce under normal operating
          conditions. Used as the denominator for capacity utilization calculations. This is
          the rated capacity after accounting for internal power consumption.
        tests:
          - not_null

      - name: is_renewable
        description: |
          Boolean flag indicating if the energy source is classified as renewable.

          **Renewable sources**: Water, Biomass, Waste, Battery Storage, Pumped Storage
          **Non-renewable sources**: All others (Coal, Natural Gas, Nuclear, Oil, etc.)

          This classification follows standard European renewable energy definitions and is
          calculated in the model using a CASE statement. Critical dimension for renewable
          energy targets and reporting.
        tests:
          - not_null
          - accepted_values:
              arguments:
                values: [true, false]

      # ===========================================
      # WEATHER METRICS - MAXIMUM VALUES
      # ===========================================

      - name: max_temperature_2m_c
        description: |
          Maximum temperature at 2 meters height in Celsius for the day.

          Captured at standard meteorological height (2m above ground). Useful for analyzing
          temperature impact on power generation efficiency and cooling requirements.

      - name: max_wind_speed_10m_mps
        description: |
          Maximum wind speed at 10 meters height in meters per second.

          Standard height for wind speed measurement. Important for wind power generation
          analysis and understanding peak wind conditions.

      - name: max_wind_speed_80m_mps
        description: |
          Maximum wind speed at 80 meters height in meters per second.

          Approximate hub height for modern wind turbines. More relevant than 10m measurements
          for wind power generation analysis as it captures wind speed at turbine level.

      - name: max_shortwave_radiation_wpm2
        description: |
          Maximum shortwave solar radiation in watts per square meter.

          Total incoming solar radiation (direct + diffuse). Primary metric for solar power
          generation potential. Peak values indicate maximum solar generation capacity during the day.

      - name: max_direct_radiation_wpm2
        description: |
          Maximum direct solar radiation in watts per square meter.

          Direct beam radiation from the sun (excludes diffuse radiation). Important for
          concentrated solar power and tracking solar installations.

      - name: max_diffuse_radiation_wpm2
        description: |
          Maximum diffuse solar radiation in watts per square meter.

          Scattered solar radiation reaching the surface (from clouds, atmosphere). Represents
          solar energy available even during cloudy conditions.

      - name: max_precipitation_mm
        description: |
          Maximum precipitation in millimeters.

          Total precipitation including rain and snow (water equivalent). Can impact hydro
          power generation and operational conditions.

      - name: max_cloud_cover_percent
        description: |
          Maximum cloud cover percentage (0-100).

          Percentage of sky covered by clouds. Inversely related to solar power generation
          and can indicate weather system patterns.

      - name: max_pressure_msl_hpa
        description: |
          Maximum mean sea level atmospheric pressure in hectopascals.

          Barometric pressure normalized to sea level. Can indicate weather patterns and
          may correlate with generation efficiency.

      - name: max_rain_mm
        description: |
          Maximum rainfall in millimeters.

          Liquid precipitation only (excludes snow). Relevant for hydroelectric generation
          and weather impact analysis.

      - name: max_snowfall_cm
        description: |
          Maximum snowfall in centimeters.

          Snow accumulation measurement. Can impact solar panel performance and operational
          conditions in winter months.

      - name: max_energy_mwh
        description: |
          Maximum energy generated in a single hour reading (megawatt-hours).

          The peak hourly energy output during the day. Calculated as value_mw * duration_hours.
          Indicates the unit's peak performance and maximum generation capacity reached.

      - name: max_value_mw
        description: |
          Maximum power output in megawatts during the day.

          The highest instantaneous power reading from all hourly measurements. Compare against
          net_electrical_capacity_mw to understand peak capacity utilization.

      # ===========================================
      # WEATHER METRICS - AVERAGE VALUES
      # ===========================================

      - name: avg_temperature_2m_c
        description: |
          Average temperature at 2 meters height in Celsius.

          Mean temperature across all hourly readings. Better indicator of overall daily
          conditions than max/min for thermal efficiency analysis.

      - name: avg_wind_speed_10m_mps
        description: |
          Average wind speed at 10 meters height in meters per second.

          Mean wind speed for the day. Useful for understanding typical wind conditions
          and average wind power generation potential.

      - name: avg_wind_speed_80m_mps
        description: |
          Average wind speed at 80 meters height in meters per second.

          Mean wind speed at turbine hub height. Best indicator of actual wind resource
          available to wind turbines throughout the day.

      - name: avg_shortwave_radiation_wpm2
        description: |
          Average shortwave solar radiation in watts per square meter.

          Mean solar radiation for the day. Primary metric for assessing daily solar
          energy potential and comparing solar generation efficiency.

      - name: avg_direct_radiation_wpm2
        description: |
          Average direct solar radiation in watts per square meter.

          Mean direct beam radiation. Indicates average conditions for concentrated
          solar power systems.

      - name: avg_diffuse_radiation_wpm2
        description: |
          Average diffuse solar radiation in watts per square meter.

          Mean scattered radiation. Helps understand cloud impact on solar generation.

      - name: avg_precipitation_mm
        description: |
          Average precipitation in millimeters.

          Mean precipitation across hourly readings. Smooths out precipitation spikes
          to show overall daily wetness.

      - name: avg_cloud_cover_percent
        description: |
          Average cloud cover percentage (0-100).

          Mean cloud coverage for the day. Strong negative correlation with solar
          power generation performance.

      - name: avg_pressure_msl_hpa
        description: |
          Average mean sea level atmospheric pressure in hectopascals.

          Mean barometric pressure. Can be used for weather pattern classification
          and generation modeling.

      - name: avg_rain_mm
        description: |
          Average rainfall in millimeters.

          Mean liquid precipitation. Relevant for hydroelectric analysis and
          operational impact studies.

      - name: avg_snowfall_cm
        description: |
          Average snowfall in centimeters.

          Mean snow accumulation. Important for winter operations and solar
          panel efficiency analysis.

      - name: avg_energy_mwh
        description: |
          Average energy generated per hour reading (megawatt-hours).

          Mean hourly energy output for the day. Best single metric for daily
          generation performance. Multiply by 24 for approximate total daily generation.

      - name: avg_value_mw
        description: |
          Average power output in megawatts.

          Mean instantaneous power across hourly readings. Compare against capacity
          to calculate capacity utilization percentage.

      # ===========================================
      # WEATHER METRICS - MINIMUM VALUES
      # ===========================================

      - name: min_temperature_2m_c
        description: |
          Minimum temperature at 2 meters height in Celsius.

          Lowest temperature recorded during the day. Useful for identifying cold
          snaps that may impact generation or require additional heating load.

      - name: min_wind_speed_10m_mps
        description: |
          Minimum wind speed at 10 meters height in meters per second.

          Lowest wind speed during the day. Helps identify calm periods with low
          wind power generation.

      - name: min_wind_speed_80m_mps
        description: |
          Minimum wind speed at 80 meters height in meters per second.

          Lowest wind speed at turbine height. Important for understanding periods
          below cut-in wind speed when turbines may not generate.

      - name: min_shortwave_radiation_wpm2
        description: |
          Minimum shortwave solar radiation in watts per square meter.

          Lowest solar radiation during the day (typically zero during night hours).
          Indicates when solar generation stops.

      - name: min_direct_radiation_wpm2
        description: |
          Minimum direct solar radiation in watts per square meter.

          Lowest direct beam radiation. Zero values indicate complete cloud cover
          or night time.

      - name: min_diffuse_radiation_wpm2
        description: |
          Minimum diffuse solar radiation in watts per square meter.

          Lowest scattered radiation. Near-zero indicates night hours.

      - name: min_precipitation_mm
        description: |
          Minimum precipitation in millimeters.

          Typically zero except during continuous rain events. Helps identify
          dry periods during the day.

      - name: min_cloud_cover_percent
        description: |
          Minimum cloud cover percentage (0-100).

          Clearest sky condition during the day. Zero indicates at least some
          completely clear periods favorable for solar generation.

      - name: min_pressure_msl_hpa
        description: |
          Minimum mean sea level atmospheric pressure in hectopascals.

          Lowest barometric pressure during the day. May indicate passage of
          weather systems.

      - name: min_rain_mm
        description: |
          Minimum rainfall in millimeters.

          Typically zero unless continuous rain throughout the day.

      - name: min_snowfall_cm
        description: |
          Minimum snowfall in centimeters.

          Typically zero unless continuous snowfall. Helps identify snow
          event timing.

      - name: min_energy_mwh
        description: |
          Minimum energy generated in a single hour reading (megawatt-hours).

          Lowest hourly energy output. Often zero for intermittent renewables
          (solar at night, wind during calm). For baseload plants, consistently
          low minimums may indicate operational issues.

      - name: min_value_mw
        description: |
          Minimum power output in megawatts during the day.

          Lowest instantaneous power reading. For variable renewables, often zero.
          For dispatchable plants, indicates minimum stable generation level.

      - name: total_energy_mwh
        description: |
          Total energy generated during the day in megawatt-hours (MWh).

          Sum of all hourly energy readings for the day. This is the primary metric
          for actual energy production and is calculated as power (MW) × duration (hours).
          Use this for tracking total daily energy output and calculating cumulative generation.

      - name: total_power_mw
        description: |
          Total power output summed across all hourly readings in megawatts.

          Sum of instantaneous power readings. Note that this is different from energy
          (which accounts for duration). Useful for understanding total power capacity
          being utilized across all hourly measurements.

      - name: avg_capacity_utilization_percent
        description: |
          Average capacity utilization percentage during the day.

          Calculated as: (Power Output / Net Electrical Capacity) × 100, then averaged
          across all hourly readings. Values close to 100% indicate full utilization.
          Lower values suggest intermittent generation, economic dispatch decisions,
          or maintenance constraints.

      - name: max_capacity_utilization_percent
        description: |
          Maximum capacity utilization percentage achieved during the day.

          The highest utilization rate reached in any hour. For renewables, this indicates
          peak conditions (e.g., brightest sun for solar, strongest wind for wind).
          For dispatchable plants, consistently high maximums indicate baseload operation.

      - name: min_capacity_utilization_percent
        description: |
          Minimum capacity utilization percentage during the day.

          The lowest utilization rate in any hour. For intermittent renewables, often zero
          (e.g., solar at night). For baseload plants, consistently low minimums may
          indicate operational issues or curtailment.
