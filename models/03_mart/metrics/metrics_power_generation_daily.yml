# =========================================
# DERIVED METRICS FOR SELF-SERVICE ANALYTICS
# =========================================
#
# These metrics provide high-level business KPIs calculated from
# the power_generation_daily semantic model measures.
#
# Note: Semantic Layer support in dbt Fusion is coming soon.
# These metrics follow the modern MetricFlow specification and will
# work with dbt Core's semantic layer today, and with Fusion when
# semantic layer support is released.

metrics:
  - name: capacity_utilization_pct
    description: |
      Capacity utilization percentage - measures how efficiently generation capacity is being used.
      Calculated as: (Average Power Output / Installed Capacity) × 100

      Values close to 100% indicate full utilization, while lower values suggest:
      - Intermittent renewables (solar/wind) dependent on weather
      - Economic dispatch decisions
      - Maintenance or operational constraints

      **Example Query:**
      "What was the capacity utilization for wind farms in Bavaria last month?"
    type: ratio
    label: Capacity Utilization %
    type_params:
      numerator:
        name: total_avg_power_output_mw
      denominator:
        name: total_installed_capacity_mw

  - name: load_factor_pct
    description: |
      Load factor percentage - ratio of average output to peak output.
      Calculated as: (Average Power Output / Peak Power Output) × 100

      High load factors (>70%) indicate consistent baseload generation (coal, nuclear, hydro).
      Low load factors (<30%) suggest peaking plants or highly variable renewables (solar, wind).

      **Example Query:**
      "Compare load factors between solar and nuclear units"
    type: ratio
    label: Load Factor %
    type_params:
      numerator:
        name: total_avg_power_output_mw
      denominator:
        name: total_max_power_output_mw

  - name: renewable_energy_share_pct
    description: |
      Renewable energy percentage of total generation.
      Calculated as: (Renewable Energy / Total Energy) × 100

      Tracks progress toward renewable energy targets and energy transition goals.
      Renewable sources include: Water, Biomass, Waste, Battery Storage, Pumped Storage.

      **Example Query:**
      "What percentage of Germany's energy came from renewables this year?"
    type: ratio
    label: Renewable Energy Share %
    type_params:
      numerator:
        name: total_energy_generated_mwh
        filter: "{{ Dimension('power_generation_daily__is_renewable') }} = True"
      denominator:
        name: total_energy_generated_mwh

  - name: avg_daily_energy_per_unit_mwh
    description: |
      Average daily energy production per unit.
      Calculated as: Total Energy Generated / Number of Units

      Useful for:
      - Benchmarking unit performance against peers
      - Identifying underperforming assets
      - Portfolio optimization decisions

      **Example Query:**
      "Which operators have the highest average energy output per unit?"
    type: ratio
    label: Avg Daily Energy per Unit (MWh)
    type_params:
      numerator:
        name: total_energy_generated_mwh
      denominator:
        name: unique_unit_count

  - name: energy_intensity_mwh_per_mw
    description: |
      Energy intensity - total energy produced per MW of installed capacity.
      Calculated as: Total Energy (MWh) / Installed Capacity (MW)

      Higher values indicate better capacity utilization over time.
      Useful for:
      - Comparing efficiency across different energy sources
      - Regional performance analysis
      - Investment return calculations

      **Example Query:**
      "Compare energy intensity between wind farms in coastal vs inland regions"
    type: ratio
    label: Energy Intensity (MWh/MW)
    type_params:
      numerator:
        name: total_energy_generated_mwh
      denominator:
        name: total_installed_capacity_mw

  - name: peak_to_average_ratio
    description: |
      Peak to average power ratio - measures generation variability.
      Calculated as: Peak Power Output / Average Power Output

      Higher ratios indicate:
      - Highly variable generation (wind, solar)
      - Peaking/cycling plants
      - Intermittent operations

      Lower ratios (close to 1.0) indicate:
      - Steady baseload generation
      - Consistent operations
      - Reliable output

      **Example Query:**
      "Which units have the most stable generation profiles?"
    type: ratio
    label: Peak to Average Ratio
    type_params:
      numerator:
        name: total_max_power_output_mw
      denominator:
        name: total_avg_power_output_mw
