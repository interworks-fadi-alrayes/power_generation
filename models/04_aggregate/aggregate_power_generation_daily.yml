version: 2

models:
  - name: aggregate_power_generation_daily
    description: Daily aggregated power generation metrics by unit with weather data
    columns:
      # Date and Unit Dimensions
      - name: generation_date
        description: Date of power generation (use generation_date__year, generation_date__month for time-based grouping)
        tests:
          - not_null

      - name: power_generation_unit_id
        description: Power generation unit identifier
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('clean_dim_unit')
                field: power_generation_unit_id

      - name: unit_name
        description: Name of the power generation unit

      - name: operator
        description: Operator of the unit

      - name: unit_city
        description: City where the unit is located

      - name: unit_state
        description: German state where the unit is located

      - name: energy_source
        description: Type of energy source
        tests:
          - not_null

      - name: plant_status
        description: Operational status of the plant

      - name: is_storage
        description: Boolean flag for storage facilities

      # Capacity Metrics
      - name: gross_capacity_mw
        description: Gross electrical capacity in megawatts (maximum for the day)

      - name: net_electrical_capacity_mw
        description: Net electrical capacity in megawatts (maximum for the day)
        tests:
          - not_null

      # Generation Metrics
      - name: number_of_readings
        description: Number of hourly power generation readings for the day
        tests:
          - not_null

      - name: total_duration_hours
        description: Total duration of power generation in hours
        tests:
          - not_null

      - name: total_energy_mwh
        description: Total energy generated in megawatt-hours
        tests:
          - not_null

      - name: avg_power_mw
        description: Average power output in megawatts

      - name: min_power_mw
        description: Minimum power output in megawatts

      - name: max_power_mw
        description: Maximum power output (peak) in megawatts

      - name: stddev_power_mw
        description: Standard deviation of power output (variability indicator)

      # Utilization Metrics
      - name: avg_capacity_utilization_percent
        description: Average capacity utilization as percentage

      - name: max_capacity_utilization_percent
        description: Peak capacity utilization as percentage

      # Weather Metrics - Temperature
      - name: avg_temperature_2m_c
        description: Average temperature at 2m in Celsius

      - name: min_temperature_2m_c
        description: Minimum temperature at 2m in Celsius

      - name: max_temperature_2m_c
        description: Maximum temperature at 2m in Celsius

      # Weather Metrics - Wind
      - name: avg_wind_speed_10m_mps
        description: Average wind speed at 10m in meters per second

      - name: avg_wind_speed_80m_mps
        description: Average wind speed at 80m in meters per second

      # Weather Metrics - Solar Radiation
      - name: avg_shortwave_radiation_wpm2
        description: Average shortwave radiation in W/m²

      - name: avg_direct_radiation_wpm2
        description: Average direct solar radiation in W/m²

      - name: avg_diffuse_radiation_wpm2
        description: Average diffuse solar radiation in W/m²

      # Weather Metrics - Precipitation
      - name: total_precipitation_mm
        description: Total precipitation in millimeters

      - name: total_rain_mm
        description: Total rainfall in millimeters

      - name: total_snowfall_cm
        description: Total snowfall in centimeters

      # Weather Metrics - Other
      - name: avg_cloud_cover_percent
        description: Average cloud cover percentage

      - name: avg_pressure_msl_hpa
        description: Average atmospheric pressure in hectopascals
